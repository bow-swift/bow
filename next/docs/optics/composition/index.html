<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bow is a library for Typed Functional Programming in Swift">
    <meta name="keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="" />
    <meta property="og:title" content="Bow" />
    <meta property="og:site_name" content="Bow" />
    <meta property="og:url" content="https://bow-swift.io" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta property="og:keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bow_swift">
    <meta name="twitter:creator" content="@bow_swift">
    <meta name="twitter:image" content="https://bow-swift.io/img/twitter-card.png" />

    <!-- Bow version metadata -->
    
    <meta name="bow-version" data-title="next" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/next/img/favicon.png">
    <!-- Main css -->
    <link rel="stylesheet" type="text/css" href="/next/css/docs.css">
    <!-- Highlighting css -->
    <link rel="stylesheet" type="text/css" href="/next/api-docs/css/highlight.css">

    <!-- Code to manage version information -->
    <script src="/next/js/doc-versions.js" defer></script>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18433785-19"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18433785-19');
</script>

    

</head>

<body id="doc-body">
<div id="wrapper">
    <div id="sidebar-wrapper">
    <div class="sidebar-brand">
        <a class="brand" href="/next/">
            <img src="/next/img/icon.svg" alt="Bow logo">
            <span>Bow</span>
        </a>
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <span class="close"></span>
        </button>
    </div>

    <div id="version-dropdown">

    <button class="button link-like" onclick="displayToggle(event)" title="Documentation">
      <span>Bow version</span>
      <span id="bow-version">
        
        next
      </span>
    </button>

    <ul class="dropdown dropdown-content">

      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/docs">
            <span>
              0.8.0
            </span>
        </a>
      </li>

      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/next/docs">
            <span>
              next
            </span>
        </a>
      </li>
      
    </ul>
</div>


    <ul class="sidebar-nav">
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Quick start</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/quick-start/getting-started/">
                        <i class="fa fa-circle"></i>
                        <span>Getting started</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/modules/">
                        <i class="fa fa-circle"></i>
                        <span>Modules</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/resources/">
                        <i class="fa fa-circle"></i>
                        <span>Resources</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>FP concepts</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/fp-concepts/glossary/">
                        <i class="fa fa-circle"></i>
                        <span>Glossary</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/functions-vs-procedures/">
                        <i class="fa fa-circle"></i>
                        <span>Functions vs Procedures</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/higher-kinded-types/">
                        <i class="fa fa-circle"></i>
                        <span>Higher Kinded Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/type-classes/">
                        <i class="fa fa-circle"></i>
                        <span>Type classes</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/data-types/">
                        <i class="fa fa-circle"></i>
                        <span>Data types</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Composition</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/composition/composition-overview/">
                        <i class="fa fa-circle"></i>
                        <span>Composition Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/composing-functions/">
                        <i class="fa fa-circle"></i>
                        <span>Composing functions</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/combining-values-of-the-same-type/">
                        <i class="fa fa-circle"></i>
                        <span>Combining values of the same type</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/transforming-data/">
                        <i class="fa fa-circle"></i>
                        <span>Transforming data</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/lifting-values-to-an-effect/">
                        <i class="fa fa-circle"></i>
                        <span>Lifting values to an effect</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/combining-independent-computations/">
                        <i class="fa fa-circle"></i>
                        <span>Combining independent computations</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/sequencing-dependent-computations/">
                        <i class="fa fa-circle"></i>
                        <span>Sequencing dependent computations</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/composition/transforming-multiple-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Transforming multiple effects</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Dependency management</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/dependency-management/dependency-management-overview/">
                        <i class="fa fa-circle"></i>
                        <span>Dependency management Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/dependency-management/partial-application/">
                        <i class="fa fa-circle"></i>
                        <span>Partial application</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/dependency-management/constructor-based-dependency-injection/">
                        <i class="fa fa-circle"></i>
                        <span>Constructor-based dependency injection</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/dependency-management/reader/">
                        <i class="fa fa-circle"></i>
                        <span>Reader</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/dependency-management/side-effectful-dependency-management/">
                        <i class="fa fa-circle"></i>
                        <span>Side-effectful dependency management</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Patterns</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/patterns/error-handling/">
                        <i class="fa fa-circle"></i>
                        <span>Error handling</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/monad-comprehensions/">
                        <i class="fa fa-circle"></i>
                        <span>Monad comprehensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/tail-recursion/">
                        <i class="fa fa-circle"></i>
                        <span>Tail recursion</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/state-based-computations/">
                        <i class="fa fa-circle"></i>
                        <span>State-based computations</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/polymorphic-programs/">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphic programs</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Optics</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/optics/optics-overview/">
                        <i class="fa fa-circle"></i>
                        <span>Optics Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/writing-your-own-optics/">
                        <i class="fa fa-circle"></i>
                        <span>Writing your own optics</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/automatic-derivation/">
                        <i class="fa fa-circle"></i>
                        <span>Automatic derivation</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/composition/">
                        <i class="fa fa-circle"></i>
                        <span>Composition</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Effects</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/effects/effects-overview/">
                        <i class="fa fa-circle"></i>
                        <span>Effects Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/suspending-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Suspending side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/manipulating-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Manipulating side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-errors/">
                        <i class="fa fa-circle"></i>
                        <span>Handling errors</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/concurrency/">
                        <i class="fa fa-circle"></i>
                        <span>Concurrency</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/running-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Running side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/retrying-and-repeating-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Retrying and repeating effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-resources/">
                        <i class="fa fa-circle"></i>
                        <span>Handling resources</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/foundation-extensions/">
                        <i class="fa fa-circle"></i>
                        <span>Foundation extensions</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Testing</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/testing/testing-overview/">
                        <i class="fa fa-circle"></i>
                        <span>Testing Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/testing/testing-type-class-instances/">
                        <i class="fa fa-circle"></i>
                        <span>Testing type class instances</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/testing/testing-side-effectful-code/">
                        <i class="fa fa-circle"></i>
                        <span>Testing side effectful code</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Integrations</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/integrations/rxswift-streams/">
                        <i class="fa fa-circle"></i>
                        <span>RxSwift streams</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Legal</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/legal/credits/">
                        <i class="fa fa-circle"></i>
                        <span>Credits</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/legal/license/">
                        <i class="fa fa-circle"></i>
                        <span>License</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
    </ul>
</div>

    <div id="doc-wrapper">
    <div class="doc-header">
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <i class="fa fa-lg fa-bars menu-icon"></i>
        </button>
    </div>
    <div class="doc-content">
        <h1 id="composition">Composition</h1>

<p class="beginner">beginner</p>

<p>Optics can compose to create more powerful optics and access deeply nested data structures in an seamless manner. The result of the composition of the 8 pairs of optics that are included in Bow is shown in the following table. Notice that not all combinations are possible for composition, and that some times the resulting optic is not the same as the optics that were composed.</p>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th><strong>Iso</strong></th>
      <th><strong>Lens</strong></th>
      <th><strong>Prism</strong></th>
      <th><strong>Optional</strong></th>
      <th><strong>Getter</strong></th>
      <th><strong>Setter</strong></th>
      <th><strong>Fold</strong></th>
      <th><strong>Traversal</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Iso</strong></td>
      <td>Iso</td>
      <td>Lens</td>
      <td>Prism</td>
      <td>Optional</td>
      <td>Getter</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
    <tr>
      <td><strong>Lens</strong></td>
      <td>Lens</td>
      <td>Lens</td>
      <td>Optional</td>
      <td>Optional</td>
      <td>Getter</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
    <tr>
      <td><strong>Prism</strong></td>
      <td>Prism</td>
      <td>Optional</td>
      <td>Prism</td>
      <td>Optional</td>
      <td>ðŸš«</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
    <tr>
      <td><strong>Optional</strong></td>
      <td>Optional</td>
      <td>Optional</td>
      <td>Optional</td>
      <td>Optional</td>
      <td>Fold</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
    <tr>
      <td><strong>Getter</strong></td>
      <td>Getter</td>
      <td>Getter</td>
      <td>ðŸš«</td>
      <td>ðŸš«</td>
      <td>Getter</td>
      <td>ðŸš«</td>
      <td>Fold</td>
      <td>ðŸš«</td>
    </tr>
    <tr>
      <td><strong>Setter</strong></td>
      <td>Setter</td>
      <td>Setter</td>
      <td>Setter</td>
      <td>Setter</td>
      <td>ðŸš«</td>
      <td>Setter</td>
      <td>ðŸš«</td>
      <td>Setter</td>
    </tr>
    <tr>
      <td><strong>Fold</strong></td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>ðŸš«</td>
      <td>Fold</td>
      <td>Fold</td>
    </tr>
    <tr>
      <td><strong>Traversal</strong></td>
      <td>Traversal</td>
      <td>Traversal</td>
      <td>Traversal</td>
      <td>Traversal</td>
      <td>Fold</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
  </tbody>
</table>

<p>Each optic can be composed using its instance method <code class="highlighter-rouge">compose</code>, which is overloaded to accept all possible combinations with other optics. Besides, for the sake of simplicity, operator <code class="highlighter-rouge">+</code> can also be used to compose any two optics.</p>

<h2 id="example-of-composition-n-ary-tree">Example of composition: N-ary Tree</h2>

<p>An N-ary tree is a tree where each node can have any number of branches. We can model it like:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">leaf</span><span class="p">(</span><span class="kt">A</span><span class="p">)</span>
    <span class="kd">indirect</span> <span class="k">case</span> <span class="nf">node</span><span class="p">(</span><span class="kt">A</span><span class="p">,</span> <span class="nv">branches</span><span class="p">:</span> <span class="kt">NEA</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>That is, we can have a leaf with an associated value, or a node with an associated value and a <code class="highlighter-rouge">NonEmptyArray</code> of branches (it must have at least one, otherwise it would be a leaf).</p>

<p>Letâ€™s imagine that we would like to combine all values of the nodes at level <code class="highlighter-rouge">m</code>. Stop for a moment and think how you would do it without optics. It does not have a trivial solution, right? Letâ€™s see if we can leverage the power of optics to do this.</p>

<p>We can start by trying to access the branches of a node. Since <code class="highlighter-rouge">NTree</code> is a sum type, the optic that we need to use is a Prism. We can use <code class="highlighter-rouge">AutoPrism</code> to get the <code class="highlighter-rouge">Prism</code> for the node side of the <code class="highlighter-rouge">NTree</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">NTree</span><span class="p">:</span> <span class="kt">AutoPrism</span> <span class="p">{}</span>

<span class="kd">func</span> <span class="n">nodePrism</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Prism</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">(</span><span class="kt">A</span><span class="p">,</span> <span class="kt">NEA</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kt">NTree</span><span class="o">.</span><span class="nf">prism</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">NTree</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">nodePrism</code> gives us a <code class="highlighter-rouge">Prism</code> to look into a <code class="highlighter-rouge">NTree</code> and get a pair of <code class="highlighter-rouge">(A, NEA&lt;NTree&lt;A&gt;&gt;)</code>, but we are only interested in the branches part. Given we have a tuple, we would need an optic that lets us focus on one of the components of a tuple.</p>

<p>Fortunately, Bow already provides these utilities. In particular, given that tuples are product types, it seems we would need a <code class="highlighter-rouge">Lens</code> to focus on the second component of the tuple. To do so, we can get the <code class="highlighter-rouge">Lens</code> from <code class="highlighter-rouge">Tuple2._1</code>. There are utilities like this from <code class="highlighter-rouge">Tuple2</code> to <code class="highlighter-rouge">Tuple10</code>, to focus on every component of the tuples.</p>

<p>Then, we can compose the previous <code class="highlighter-rouge">Prism</code> with this <code class="highlighter-rouge">Lens</code> to get an <code class="highlighter-rouge">Optional</code> (see table above) that focuses only on the branches of a node:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">branchesOptional</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">NEA</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;&gt;&gt;</span> <span class="p">{</span>
    <span class="nf">nodePrism</span><span class="p">()</span> <span class="o">+</span> <span class="kt">Tuple2</span><span class="o">.</span><span class="n">_1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, we would like to be able to traverse each individual branch and modify them in isolation. This would give us a way of visiting the branches under the first level of the tree. If we look into the focus of the <code class="highlighter-rouge">branchesOptional</code> we can see that it is a <code class="highlighter-rouge">NonEmptyArray</code>, which already has a <code class="highlighter-rouge">Traversal</code> to visit each element. Therefore, if we compose them, we can get a <code class="highlighter-rouge">Traversal</code> with foci in each node of the first level under the provided node:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">levelTraversal</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Traversal</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="nf">branchesOptional</span><span class="p">()</span> <span class="o">+</span> <span class="kt">NEA</span><span class="o">.</span><span class="n">traversal</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Looking at <code class="highlighter-rouge">levelTraversal</code> we can see that its source and focus types match. That means we can compose with itself in order to go further down in the tree structure, level by level. We can write a function that gets us a <code class="highlighter-rouge">Traversal</code> focused on the nodes of the <code class="highlighter-rouge">m</code> level, just by composing the <code class="highlighter-rouge">levelTraversal</code> with itself <code class="highlighter-rouge">m</code> times:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">level</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">m</span><span class="p">:</span> <span class="kt">UInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Traversal</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">m</span><span class="p">)</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="nf">levelTraversal</span><span class="p">()</span> <span class="p">}</span>
        <span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="kt">Traversal</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="o">+</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the function above, if <code class="highlighter-rouge">m</code> is 0, we return <code class="highlighter-rouge">Traversal.identity</code>, which is a <code class="highlighter-rouge">Traversal</code> that focuses on the source itself, corresponding to visiting level 0 of the tree. Otherwise, we create <code class="highlighter-rouge">m</code> instances of the <code class="highlighter-rouge">levelTraversal</code> and combine them all into a single one, to get a <code class="highlighter-rouge">Traversal</code> that focuses on nodes at level <code class="highlighter-rouge">m</code>.</p>

<p>We wanted to combine values of the nodes at level <code class="highlighter-rouge">m</code>. First, we would need to extract the values out of the <code class="highlighter-rouge">NTrees</code>. Since all cases in <code class="highlighter-rouge">NTree</code> have a value, we can write a custom <code class="highlighter-rouge">Getter</code> to do this:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">valueGetter</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Getter</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">A</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kt">Getter</span><span class="p">(</span><span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">state</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">leaf</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">),</span> <span class="o">.</span><span class="nf">node</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">,</span> <span class="nv">branches</span><span class="p">:</span> <span class="n">_</span><span class="p">):</span> <span class="k">return</span> <span class="n">value</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can convert the <code class="highlighter-rouge">Traversal</code> to a <code class="highlighter-rouge">Fold</code> using the <code class="highlighter-rouge">asFold</code> property. We can get a <code class="highlighter-rouge">Fold</code> to combine values at level <code class="highlighter-rouge">m</code> as:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">levelFold</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">m</span><span class="p">:</span> <span class="kt">UInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Fold</span><span class="o">&lt;</span><span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">A</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">level</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">asFold</span> <span class="o">+</span> <span class="nf">valueGetter</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, if we get a tree whose values have an instance of <code class="highlighter-rouge">Monoid</code>, we can combine all its values at level <code class="highlighter-rouge">m</code> by:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">combineValues</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">Monoid</span><span class="o">&gt;</span><span class="p">(</span><span class="n">of</span> <span class="nv">tree</span><span class="p">:</span> <span class="kt">NTree</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">at</span> <span class="nv">level</span><span class="p">:</span> <span class="kt">UInt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">A</span> <span class="p">{</span>
    <span class="nf">levelFold</span><span class="p">(</span><span class="n">level</span><span class="p">)</span><span class="o">.</span><span class="nf">combineAll</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="summary">Summary</h2>

<p>With this example we have seen how we can use auto-generated, custom and library-provided optics, to build more complex ones that help us perfom a complicated task in an easy and seamless manner.</p>

    </div>
</div>

</div>
<!-- Custom scripts for this template -->
<script src="/next/js/docs.js"></script>
<!-- Gitter -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'bowswift/bow'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

</body>
</html>
